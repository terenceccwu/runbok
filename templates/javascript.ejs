<% if (imports.length > 0) { -%>
<% imports.forEach(imp => { -%>
<%- imp %>
<% }); -%>

<% } -%>
<% functions.forEach(func => { -%>
const <%- func.name %> = <%- func.code %>;

<% }); -%>
const main = async (input) => {
  const ctx = Object.assign({}, input);
<% computedFields.forEach(field => { -%>
  ctx["<%- field.name %>"] = await compute_<%- field.name %>(ctx);<% if (field.dependencies && field.dependencies.length > 0) { %> // depends on: <%- field.dependencies.join(', ') %><% } %>
<% }); -%>
  return ctx;
};

module.exports = main;
